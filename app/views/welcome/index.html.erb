<%= render 'requests/new_request_form', request: Request.new %>
<div class='row collapse'>
  <ul class='button-group even-3 small-12 columns river-nav'>
    <li><%= button_to 'Group Activity', river_path, {method: 'get', form_class: "river-form", class: 'small button river-btn'} %></li>
    <li><%= button_to 'Active Requests', active_path, {method: 'get', form_class: "river-form", class: 'small button river-btn'} %></li>
    <li><%= button_to 'Your History', history_path, {method: 'get', form_class: "river-form", class: 'small button river-btn'} %></li>
  </ul>
</div>

<div id="river">
</div>

<script type="text/javascript" charset="utf-8">
  var pusher = new Pusher('545220afdca7480dd648', {
    encrypted: true,
    authEndpoint: '/pusher/groupauth',
    auth: {
      headers: {
        'X-CSRF-Token': '<%= form_authenticity_token %>'
      }
    }
  });

  var channel = pusher.subscribe('presence-<%= current_user.group_id %>');

  channel.bind("new_transaction", function(data) {
    var element = '<li>' + data.content + '</li>';

    $('#group-transactions').append(element);

    if (data.user_id === <%= current_user.id %>) {
      $('#my-transactions').append(element);
    }

  });

  channel.bind("new_request_posted", function(data) {
    $('#active-requests').append('<li>' + data.content + '</li>');
  });
</script>

